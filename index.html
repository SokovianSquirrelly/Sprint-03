<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <title>Temple Locations</title>

    <style>
      html,
      body,
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }
    </style>

    <link
      rel="stylesheet"
      href="https://js.arcgis.com/4.24/esri/themes/light/main.css"
    />
    <script src="https://js.arcgis.com/4.24/"></script>

    <script>
      require([
        "esri/config",
        "esri/Map",
        "esri/views/MapView",
        "esri/Graphic",
        "esri/layers/GraphicsLayer",
      ], function (config, Map, MapView, Graphic, GraphicsLayer) {
        const map = new Map({
          basemap: "gray-vector", // Basemap layer service
        });

        // This is the view that shows up when you first open the application.  It's zoomed in on Rexburg, Idaho.

        const view = new MapView({
          map: map,
          center: [-111.792, 43.823], // Longitude, latitude
          zoom: 12, // Zoom level
          container: "viewDiv", // Div element
        });

        const graphicsLayer = new GraphicsLayer();
        map.add(graphicsLayer);

        function displayPoint(
          graphicsLayer,
          name,
          latitude,
          longitude,
          status,
          dedDate
        ) {
          const point = {
            type: "point",
            longitude: longitude,
            latitude: latitude,
          };

          let color = [0, 0, 0];

          switch (status) {
            case "Dedicated":
              color = [0, 255, 0]; // Green
              break;
            case "Construction":
              color = [255, 255, 0]; // Yellow
              break;
            case "Announced":
              color = [255, 165, 0]; // Orange
              break;
            case "Unknown Location":
              color = [255, 0, 0]; // Red
              break;
            case "Prediction":
              color = [128, 128, 128]; // Gray
              break;
          }

          const simpleMarkerSymbol = {
            type: "simple-marker",
            color: color,
            outline: {
              color: [0, 0, 0],
              width: 1,
            },
          };

          const popupTemplate = {
            title: "{Name}",
            content: "{Dedication}",
          };

          const attributes = {
            Name: name,
            Dedication: dedDate,
          };

          const pointGraphic = new Graphic({
            geometry: point,
            symbol: simpleMarkerSymbol,
            attributes: attributes,
            popupTemplate: popupTemplate,
          });
          graphicsLayer.add(pointGraphic);
        }

        // Here is a list of every single temple and the relevant information for this map.

        async function getTempleData() {
          const response = await fetch("data/confirmedTemples.json");

          if (response.ok) {
            const data = await response.json();
            displayTemples(data);
          }
        }

        async function getPredictionData() {
          const response = await fetch("data/predictions.json");

          if (response.ok) {
            const data = await response.json();
            displayPredictions(data);
          }
        }

        function displayTemples(data) {
          data.forEach((temple) => {
            displayPoint(
              graphicsLayer,
              temple.name,
              temple.latitude,
              temple.longitude,
              temple.status,
              temple.dedication_date
            );
          });
        }

        function displayPredictions(data) {
          data.forEach((prediction) => {
            displayPoint(
              graphicsLayer,
              prediction.city,
              prediction.latitude,
              prediction.longitude,
              "Prediction",
              `Confidence Level: ${prediction.confidence_level}`
            );
          })
        }

        getTempleData();
        getPredictionData();
      });
    </script>
  </head>
  <body>
    <div id="viewDiv"></div>
  </body>
</html>
